<!--
 This build file contains the rules to build
 all the different statistics and snapshots built
 by the argouml-gen project.
 
 Description of the set-up are in http://argouml-gen.tigris.org/techdoc.html
 -->

<project name="argouml-gen" default="report:jdepend" basedir=".">
  <description>
        Build some targets in another project and save results to CVS.
    </description>
  <property name="cvs.root" value=":pserver:guest@cvs.tigris.org:/cvs"/>
  <property name="project.to.build" value="argouml"/>
  <property name="working.dir" location="${basedir}/tmp"/>
  <property name="argouml.dir" location="${working.dir}/argouml"/>
  <property name="argouml.src.dir" location="${argouml.dir}/src_new"/>
  
  <property name="xsl.dir" location="${basedir}/xsl"/>

  <property name="instrument-ant.xsl" location="${xsl.dir}/instrument-ant.xsl"/>

  <target name="init">
    <!-- Common initializations. -->
    <mkdir dir="${working.dir}"/>
  </target>

  <!-- ================================================================ -->
  <!-- Things that depend on the source of ArgoUML                      -->
  <!-- ================================================================ -->

  <target name="update" depends="init" description="update the project from CVS">
    <echo>CVSROOT is ${cvs.root}</echo>
    <cvs cvsRoot="${cvs.root}" quiet="Yes" dest="${working.dir}" package="argouml/src"/>
    <cvs cvsRoot="${cvs.root}" quiet="Yes" dest="${working.dir}" package="argouml/src_new"/>
    <cvs cvsRoot="${cvs.root}" quiet="Yes" dest="${working.dir}" package="argouml/tests"/>
    <cvs cvsRoot="${cvs.root}" quiet="Yes" dest="${working.dir}" package="argouml/lib"/>
    <cvs cvsRoot="${cvs.root}" quiet="Yes" dest="${working.dir}" package="argouml/modules"/>
    <cvs cvsRoot="${cvs.root}" quiet="Yes" dest="${working.dir}" package="argouml/tools"/>
    <cvs cvsRoot="${cvs.root}" quiet="Yes" dest="${working.dir}" package="argouml-es/src"/>
    <cvs cvsRoot="${cvs.root}" quiet="Yes" dest="${working.dir}" package="argouml-nb/src"/>
    <cvs cvsRoot="${cvs.root}" quiet="Yes" dest="${working.dir}" package="argouml-sv/src"/>
    <cvs cvsRoot="${cvs.root}" quiet="Yes" dest="${working.dir}" package="argouml-i18n-zh/src"/>
  </target>

  <target name="clean" description="remove all generated reports">
    <ant dir="${argouml.src.dir}" antfile="build-reports.xml" target="clean"/>
  </target>
  
  <target name="init-reports">
    <copy file="build-reports.xml" todir="${argouml.src.dir}" overwrite="true"/>
    <copy file="reporting.properties" todir="${argouml.src.dir}" overwrite="true"/>
  </target>
  
  <target name="report:jcoverage" depends="init-reports" description="generate jcoverage reports">
    <ant dir="${argouml.src.dir}" antfile="build-reports.xml" target="report:jcoverage"/>
  </target>

  <target name="report:jdepend" depends="init-reports" description="generate jdepend reports">
    <ant dir="${argouml.src.dir}" antfile="build-reports.xml" target="report:jdepend"/>
  </target>

  <target name="report:checkstyle" depends="init-reports" description="generate checkstyle reports">
    <ant dir="${argouml.src.dir}" antfile="build-reports.xml" target="report:checkstyle"/>
  </target>

  <target name="report:junit" depends="init-reports" description="generate junit reports">
    <ant dir="${argouml.src.dir}" antfile="build-reports.xml" target="report:junit"/>
  </target>

  <target name="report:javadocs" depends="init-reports" description="generate javadocs reports">
    <ant dir="${argouml.src.dir}" antfile="build-reports.xml" target="report:javadocs"/>
  </target>

  <target name="report:findbugs" depends="init-reports" description="generate FindBug reports">
    <ant dir="${argouml.src.dir}" antfile="build-reports.xml" target="report:findbugs"/>
  </target>

  <target name="report:i18ncomparison" description="generate comparison between internationalizations.">
    <property name="output.dir"
              location="${argouml.dir}/build/reports/i18ncomparison"/>
    <mkdir dir="${output.dir}"/>
    <exec executable="tools/bin/compare-i18n.sh"
          output="${output.dir}/index.html"/>
  </target>

</project>
