<!--
 This build file checks out the latest version of 
 
 Ideally, run this build.xml file with the command:
  ant -logger org.apache.tools.ant.XmlLogger -logfile www/log.xml

 Unfornately, the resulting file is huge and renders VERY slowly.
 So, instead use this:
  ant -logfile www/log.txt


-->

<project name="argouml-gen" default="all" basedir=".">
    <description>
        Build some targets in another project and save results to CVS.
    </description>
  <!-- set global properties for this build -->
  <property file="build.properties" />
  <property name="cvs.user" value="${user.name}" />
  <property name="cvs.root" value=":pserver:${cvs.user}@tigris.org:/cvs" />
  <property name="project.to.build" value="argouml" />
  <property name="src.module" value="argouml/src_new" />
  <property name="lib.module" value="argouml/lib" />
  <property name="tests.module" value="argouml/tests" />
  <property name="docs.module" value="argouml/documentation" />


  <target name="init"
        description="set the timestamp.  not really needed yet." >
    <tstamp>
     <format property="touch.time" pattern="yyyy-MM-dd hh:mm aa" />
    </tstamp>
    <buildnumber />
    <echo taskname="buildnumber" message="build number: ${build.number}" />
    <echo taskname="date" message="Date: ${touch.time}" />
  </target>

  <target name="update" depends="init"
     description="update the other project from CVS">
    <cvs cvsRoot="${cvs.root}" package="${src.module}" quiet="true" />
    <cvs cvsRoot="${cvs.root}" package="${lib.module}" quiet="true" />
    <cvs cvsRoot="${cvs.root}" package="${tests.module}" quiet="true" />
    <cvs cvsRoot="${cvs.root}" package="${docs.module}" quiet="true" />
  </target>

  <target name="compile" depends="update"
        description="compile the source and assemble other files" >
    <ant dir="${src.module}" target="compile" />
  </target>

  <target name="tests" depends="update"
        description="run unit tests" >
    <ant dir="${src.module}" target="tests" />
    <copy todir="www">
     <fileset dir="${project.to.build}/build/tests/reports" />
    </copy>
  </target>


  <!-- this target is currently not working, due to saxon error -->
  <target name="docs" depends="update"
        description="generate html documentation" >
    <ant dir="${docs.module}" />
    <copy todir="www">
     <fileset dir="${project.to.build}/www/documentation/defaulthtml" />
    </copy>
  </target>

  <target name="javadocs" depends="update"
        description="generate javadocs" >
    <ant dir="${src.module}" target="javadocs" />
    <copy todir="www/api">
     <fileset dir="${project.to.build}/build/javadocs" />
    </copy>
    <!-- <cvs command="-q add www/api/edu/uci/${project.to.build}/util/*.html" /> -->
  </target>

  <target name="all" depends="compile,javadocs,tests"
        description="do everything except commit">
    <echo taskname="finished"
      message="Build has finished. Please review locally,
      then use 'cvs commit build.number www'." />
  </target>


</project>
